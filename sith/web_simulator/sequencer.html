<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SITH - R2-D2 Sequencer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sequencer-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .dome-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .dome-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .dome {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, #4a4a4a 0%, #2a2a2a 100%);
            border: 4px solid #666;
            position: relative;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .panel {
            background: #333;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .panel.open {
            background: #4CAF50;
            border-color: #66BB6A;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .panel.closed {
            background: #333;
            border-color: #555;
        }

        .panel.selected {
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .sequencer-controls {
            margin-bottom: 20px;
        }

        .sequencer-controls h3 {
            margin-bottom: 15px;
            color: #FFD700;
            font-size: 1.3em;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn.secondary {
            background: #2196F3;
        }

        .btn.secondary:hover:not(:disabled) {
            background: #1976D2;
        }

        .btn.danger {
            background: #F44336;
        }

        .btn.danger:hover:not(:disabled) {
            background: #D32F2F;
        }

        .btn.warning {
            background: #FF9800;
        }

        .btn.warning:hover:not(:disabled) {
            background: #F57C00;
        }

        .step-editor {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .step-editor h4 {
            margin-bottom: 10px;
            color: #FFD700;
        }

        .step-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .step-inputs input, .step-inputs select {
            padding: 8px;
            border: none;
            border-radius: 4px;
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .step-inputs label {
            font-size: 0.9em;
            margin-bottom: 5px;
            display: block;
        }

        .sequence-list {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .sequence-item {
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .sequence-item:hover {
            background: rgba(255,255,255,0.2);
        }

        .sequence-item.active {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4CAF50;
        }

        .sequence-info {
            flex: 1;
        }

        .sequence-info .step-number {
            font-weight: bold;
            color: #FFD700;
        }

        .sequence-info .step-description {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .sequence-actions {
            display: flex;
            gap: 5px;
        }

        .sequence-actions button {
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 4px;
        }

        .timeline {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .timeline h4 {
            margin-bottom: 10px;
            color: #FFD700;
        }

        .timeline-bar {
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 20px;
        }

        .timeline-marker {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px;
            background: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .status-bar .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .demo-notice {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .demo-notice h3 {
            color: #FFC107;
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .dome {
                width: 250px;
                height: 250px;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .step-inputs {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styling */
        .sequence-list::-webkit-scrollbar {
            width: 8px;
        }

        .sequence-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .sequence-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .sequence-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ SITH - R2-D2 Sequencer</h1>
            <p>Visual Sequence Editor & Player</p>
        </header>

        <div class="demo-notice">
            <h3>üéÆ Interactive Sequencer</h3>
            <p>Create custom R2-D2 sequences by clicking panels and setting timing. Build your own panel choreography!</p>
        </div>

        <div class="main-content">
            <!-- Sequencer Controls -->
            <div class="sequencer-section">
                <h2>üé¨ Sequence Editor</h2>
                
                <div class="sequencer-controls">
                    <h3>Controls</h3>
                    <div class="control-buttons">
                        <button class="btn" id="playBtn" onclick="playSequence()">‚ñ∂Ô∏è Play</button>
                        <button class="btn secondary" id="pauseBtn" onclick="pauseSequence()" disabled>‚è∏Ô∏è Pause</button>
                        <button class="btn danger" id="stopBtn" onclick="stopSequence()" disabled>‚èπÔ∏è Stop</button>
                        <button class="btn secondary" onclick="addStep()">‚ûï Add Step</button>
                        <button class="btn warning" onclick="clearSequence()">üóëÔ∏è Clear</button>
                        <button class="btn secondary" onclick="loadPreset()">üìÅ Load Preset</button>
                    </div>
                </div>

                <div class="step-editor">
                    <h4>Step Editor</h4>
                    <div class="step-inputs">
                        <div>
                            <label>Duration (ms):</label>
                            <input type="number" id="stepDuration" value="500" min="100" max="5000">
                        </div>
                        <div>
                            <label>Action:</label>
                            <select id="stepAction">
                                <option value="open">Open Panel</option>
                                <option value="close">Close Panel</option>
                                <option value="openAll">Open All</option>
                                <option value="closeAll">Close All</option>
                                <option value="wait">Wait</option>
                            </select>
                        </div>
                    </div>
                    <div class="step-inputs">
                        <div>
                            <label>Panel Number:</label>
                            <input type="number" id="stepPanel" value="1" min="1" max="16" disabled>
                        </div>
                        <div>
                            <label>Description:</label>
                            <input type="text" id="stepDescription" placeholder="Step description">
                        </div>
                    </div>
                    <button class="btn" onclick="addCurrentStep()" style="width: 100%; margin-top: 10px;">
                        Add Step to Sequence
                    </button>
                </div>

                <div class="timeline">
                    <h4>Timeline</h4>
                    <div class="timeline-bar">
                        <div class="timeline-progress" id="timelineProgress"></div>
                        <div class="timeline-marker" id="timelineMarker" style="left: 0%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em;">
                        <span id="currentTime">0ms</span>
                        <span id="totalTime">0ms</span>
                    </div>
                </div>
            </div>

            <!-- R2-D2 Dome Visualization -->
            <div class="dome-section">
                <h2>üé≠ R2-D2 Dome</h2>
                <div class="dome-container">
                    <div class="dome" id="dome">
                        <!-- Panels will be generated by JavaScript -->
                    </div>
                    <div class="dome-info">
                        <div class="status-indicator">
                            <span class="status-dot"></span>
                            <span id="domeStatus">Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sequence List -->
        <div class="sequencer-section">
            <h2>üìã Sequence Steps</h2>
            <div class="sequence-list" id="sequenceList">
                <div style="text-align: center; opacity: 0.6; padding: 20px;">
                    No steps in sequence. Click panels or use the editor above to add steps.
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Ready</span>
            </div>
            <div class="status-item">
                <span>Steps:</span>
                <span id="stepCount">0</span>
            </div>
            <div class="status-item">
                <span>Duration:</span>
                <span id="totalDuration">0ms</span>
            </div>
            <div class="status-item">
                <span>Time:</span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>

    <script>
        // SITH R2-D2 Sequencer JavaScript
        class SITHSequencer {
            constructor() {
                this.panels = [];
                this.sequence = [];
                this.currentStep = 0;
                this.isPlaying = false;
                this.isPaused = false;
                this.playbackStartTime = 0;
                this.pausedTime = 0;
                this.selectedPanel = null;
                
                this.initializeEventListeners();
                this.initializeDome();
                this.updateTime();
                
                // Update time every second
                setInterval(() => this.updateTime(), 1000);
                
                // Load default presets
                this.loadPresets();
            }
            
            initializeEventListeners() {
                // Step action change
                document.getElementById('stepAction').addEventListener('change', (e) => {
                    const panelInput = document.getElementById('stepPanel');
                    if (e.target.value === 'open' || e.target.value === 'close') {
                        panelInput.disabled = false;
                    } else {
                        panelInput.disabled = true;
                    }
                });
                
                // Auto-generate description
                document.getElementById('stepAction').addEventListener('change', this.updateStepDescription.bind(this));
                document.getElementById('stepPanel').addEventListener('change', this.updateStepDescription.bind(this));
                document.getElementById('stepDuration').addEventListener('change', this.updateStepDescription.bind(this));
            }
            
            initializeDome() {
                const dome = document.getElementById('dome');
                
                // Create 16 panels (4x4 grid)
                for (let i = 1; i <= 16; i++) {
                    const panel = document.createElement('div');
                    panel.className = 'panel closed';
                    panel.id = `panel-${i}`;
                    panel.textContent = i;
                    panel.addEventListener('click', () => {
                        this.selectPanel(i);
                    });
                    dome.appendChild(panel);
                    this.panels.push(panel);
                }
            }
            
            selectPanel(panelNum) {
                // Clear previous selection
                this.panels.forEach(panel => panel.classList.remove('selected'));
                
                // Select new panel
                this.selectedPanel = panelNum;
                this.panels[panelNum - 1].classList.add('selected');
                
                // Update step editor
                document.getElementById('stepPanel').value = panelNum;
                this.updateStepDescription();
            }
            
            updateStepDescription() {
                const action = document.getElementById('stepAction').value;
                const panel = document.getElementById('stepPanel').value;
                const duration = document.getElementById('stepDuration').value;
                
                let description = '';
                switch (action) {
                    case 'open':
                        description = `Open panel ${panel} for ${duration}ms`;
                        break;
                    case 'close':
                        description = `Close panel ${panel} for ${duration}ms`;
                        break;
                    case 'openAll':
                        description = `Open all panels for ${duration}ms`;
                        break;
                    case 'closeAll':
                        description = `Close all panels for ${duration}ms`;
                        break;
                    case 'wait':
                        description = `Wait for ${duration}ms`;
                        break;
                }
                
                document.getElementById('stepDescription').value = description;
            }
            
            addStep() {
                const action = document.getElementById('stepAction').value;
                const panel = parseInt(document.getElementById('stepPanel').value);
                const duration = parseInt(document.getElementById('stepDuration').value);
                const description = document.getElementById('stepDescription').value || this.generateStepDescription(action, panel, duration);
                
                const step = {
                    id: Date.now(),
                    action: action,
                    panel: panel,
                    duration: duration,
                    description: description
                };
                
                this.sequence.push(step);
                this.updateSequenceList();
                this.updateStatus();
            }
            
            generateStepDescription(action, panel, duration) {
                switch (action) {
                    case 'open':
                        return `Open panel ${panel} for ${duration}ms`;
                    case 'close':
                        return `Close panel ${panel} for ${duration}ms`;
                    case 'openAll':
                        return `Open all panels for ${duration}ms`;
                    case 'closeAll':
                        return `Close all panels for ${duration}ms`;
                    case 'wait':
                        return `Wait for ${duration}ms`;
                    default:
                        return `Step ${this.sequence.length + 1}`;
                }
            }
            
            addCurrentStep() {
                this.addStep();
            }
            
            updateSequenceList() {
                const list = document.getElementById('sequenceList');
                list.innerHTML = '';
                
                if (this.sequence.length === 0) {
                    list.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 20px;">No steps in sequence. Click panels or use the editor above to add steps.</div>';
                    return;
                }
                
                this.sequence.forEach((step, index) => {
                    const item = document.createElement('div');
                    item.className = 'sequence-item';
                    if (index === this.currentStep && this.isPlaying) {
                        item.classList.add('active');
                    }
                    
                    item.innerHTML = `
                        <div class="sequence-info">
                            <div class="step-number">Step ${index + 1}</div>
                            <div class="step-description">${step.description}</div>
                        </div>
                        <div class="sequence-actions">
                            <button class="btn secondary" onclick="sequencer.moveStepUp(${index})" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                            <button class="btn secondary" onclick="sequencer.moveStepDown(${index})" ${index === this.sequence.length - 1 ? 'disabled' : ''}>‚Üì</button>
                            <button class="btn danger" onclick="sequencer.removeStep(${index})">√ó</button>
                        </div>
                    `;
                    
                    list.appendChild(item);
                });
            }
            
            moveStepUp(index) {
                if (index > 0) {
                    [this.sequence[index], this.sequence[index - 1]] = [this.sequence[index - 1], this.sequence[index]];
                    this.updateSequenceList();
                }
            }
            
            moveStepDown(index) {
                if (index < this.sequence.length - 1) {
                    [this.sequence[index], this.sequence[index + 1]] = [this.sequence[index + 1], this.sequence[index]];
                    this.updateSequenceList();
                }
            }
            
            removeStep(index) {
                this.sequence.splice(index, 1);
                this.updateSequenceList();
                this.updateStatus();
            }
            
            clearSequence() {
                this.sequence = [];
                this.currentStep = 0;
                this.updateSequenceList();
                this.updateStatus();
                this.resetDome();
            }
            
            playSequence() {
                if (this.sequence.length === 0) {
                    alert('No steps in sequence!');
                    return;
                }
                
                this.isPlaying = true;
                this.isPaused = false;
                this.playbackStartTime = Date.now() - this.pausedTime;
                this.updateButtons();
                this.updateStatus();
                this.runSequence();
            }
            
            pauseSequence() {
                this.isPaused = true;
                this.pausedTime = Date.now() - this.playbackStartTime;
                this.updateButtons();
                this.updateStatus();
            }
            
            stopSequence() {
                this.isPlaying = false;
                this.isPaused = false;
                this.currentStep = 0;
                this.pausedTime = 0;
                this.updateButtons();
                this.updateStatus();
                this.updateSequenceList();
                this.resetDome();
            }
            
            runSequence() {
                if (!this.isPlaying || this.isPaused) return;
                
                if (this.currentStep >= this.sequence.length) {
                    this.stopSequence();
                    return;
                }
                
                const step = this.sequence[this.currentStep];
                this.executeStep(step);
                this.updateSequenceList();
                
                this.currentStep++;
                
                if (this.isPlaying && !this.isPaused) {
                    setTimeout(() => this.runSequence(), step.duration);
                }
            }
            
            executeStep(step) {
                switch (step.action) {
                    case 'open':
                        this.setPanelState(step.panel, 'open');
                        break;
                    case 'close':
                        this.setPanelState(step.panel, 'closed');
                        break;
                    case 'openAll':
                        this.panels.forEach(panel => this.setPanelState(panel, 'open'));
                        break;
                    case 'closeAll':
                        this.panels.forEach(panel => this.setPanelState(panel, 'closed'));
                        break;
                    case 'wait':
                        // Just wait, no panel changes
                        break;
                }
            }
            
            setPanelState(panelNum, state) {
                if (panelNum >= 1 && panelNum <= 16) {
                    this.panels[panelNum - 1].className = `panel ${state}`;
                }
            }
            
            resetDome() {
                this.panels.forEach(panel => this.setPanelState(panel, 'closed'));
            }
            
            updateButtons() {
                document.getElementById('playBtn').disabled = this.isPlaying && !this.isPaused;
                document.getElementById('pauseBtn').disabled = !this.isPlaying || this.isPaused;
                document.getElementById('stopBtn').disabled = !this.isPlaying;
            }
            
            updateStatus() {
                const totalDuration = this.sequence.reduce((sum, step) => sum + step.duration, 0);
                const currentDuration = this.sequence.slice(0, this.currentStep).reduce((sum, step) => sum + step.duration, 0);
                
                document.getElementById('stepCount').textContent = this.sequence.length;
                document.getElementById('totalDuration').textContent = `${totalDuration}ms`;
                document.getElementById('currentTime').textContent = `${currentDuration}ms`;
                
                // Update timeline
                const progress = totalDuration > 0 ? (currentDuration / totalDuration) * 100 : 0;
                document.getElementById('timelineProgress').style.width = `${progress}%`;
                document.getElementById('timelineMarker').style.left = `${progress}%`;
                
                // Update status text
                let statusText = 'Ready';
                if (this.isPlaying) {
                    statusText = this.isPaused ? 'Paused' : 'Playing';
                }
                document.getElementById('statusText').textContent = statusText;
                document.getElementById('domeStatus').textContent = statusText;
            }
            
            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                document.getElementById('currentTime').textContent = timeString;
            }
            
            loadPresets() {
                // This would load preset sequences
                // For now, we'll just initialize
            }
            
            loadPreset() {
                const presets = {
                    'Wave': [
                        { action: 'closeAll', panel: 0, duration: 200, description: 'Close all panels' },
                        { action: 'open', panel: 1, duration: 300, description: 'Open panel 1' },
                        { action: 'open', panel: 2, duration: 300, description: 'Open panel 2' },
                        { action: 'open', panel: 3, duration: 300, description: 'Open panel 3' },
                        { action: 'open', panel: 4, duration: 300, description: 'Open panel 4' },
                        { action: 'closeAll', panel: 0, duration: 600, description: 'Close all panels' }
                    ],
                    'Scream': [
                        { action: 'closeAll', panel: 0, duration: 200, description: 'Close all panels' },
                        { action: 'openAll', panel: 0, duration: 1000, description: 'SCREAM! Open all panels' },
                        { action: 'closeAll', panel: 0, duration: 1500, description: 'Close all panels' }
                    ],
                    'Dance': [
                        { action: 'open', panel: 1, duration: 200, description: 'Open panel 1' },
                        { action: 'open', panel: 3, duration: 200, description: 'Open panel 3' },
                        { action: 'open', panel: 5, duration: 200, description: 'Open panel 5' },
                        { action: 'close', panel: 1, duration: 200, description: 'Close panel 1' },
                        { action: 'close', panel: 3, duration: 200, description: 'Close panel 3' },
                        { action: 'close', panel: 5, duration: 200, description: 'Close panel 5' },
                        { action: 'open', panel: 2, duration: 200, description: 'Open panel 2' },
                        { action: 'open', panel: 4, duration: 200, description: 'Open panel 4' },
                        { action: 'open', panel: 6, duration: 200, description: 'Open panel 6' },
                        { action: 'closeAll', panel: 0, duration: 500, description: 'Close all panels' }
                    ]
                };
                
                const presetName = prompt('Choose preset:\n' + Object.keys(presets).join('\n'));
                if (presetName && presets[presetName]) {
                    this.sequence = presets[presetName].map(step => ({ ...step, id: Date.now() + Math.random() }));
                    this.updateSequenceList();
                    this.updateStatus();
                }
            }
        }

        // Global functions for HTML onclick handlers
        let sequencer;

        function playSequence() {
            sequencer.playSequence();
        }

        function pauseSequence() {
            sequencer.pauseSequence();
        }

        function stopSequence() {
            sequencer.stopSequence();
        }

        function addStep() {
            sequencer.addStep();
        }

        function clearSequence() {
            sequencer.clearSequence();
        }

        function loadPreset() {
            sequencer.loadPreset();
        }

        function addCurrentStep() {
            sequencer.addCurrentStep();
        }

        // Initialize the sequencer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            sequencer = new SITHSequencer();
        });
    </script>
</body>
</html>